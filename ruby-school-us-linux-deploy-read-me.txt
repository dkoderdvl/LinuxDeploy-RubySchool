Инструкция по развертыванию учебного окружения на android устройстве (даллее android) для изучения курса rubyschool.us

Автор курса RobySchool: Роман Пушкин
Домашняя страница: http://rubyschool.us/
Чат школы в телеграм: https://telegram.me/rubyschool

Спасибо Роману!

!!! Важно !!! любые дествия в Linux Deploy и с файлами образов, нужно предворять командой СТОП (я делаю пару раз), иначе возможно попортить или контейнер или android.
!!! Важно !!! Если Вы не уверены запущен контейнер или нет, сначала жмите СТАРТ потом СТОП - хуже точно не будет



1. !!! Люди делайте резервные копии всего важного !!!
перед началом развертывания, при изменении чего либо, да и просто от нечего делать - делайте резервные копии!!!
!!! Все что вы делаете - делаете на свой страх и риск!!!

2. !!!архитектура android (в основном ARM) на данный момент не являтся стопроцентным заменителем архитектуры x86
т.е. работает примерно 70% софта, но направление быстро развивается

3. !!! данная статья - это личный опыт по развертыванию учебного окружения под мои требования на моем оборудовании

Устройство: xiaomi MI5s Plus (128/6)
Прошивка: Masik U 2.3 - рутованная
Архитектура: ARM64
Версия Linux Deplohy 2.2.2
Дистрибутив: ubuntu - bionic

Что работает:
- терминал, mc
- RVM
- Ruby 2.6
- Rails 5.2
- Firefox
- git
- ungit
- Geany (редактор разработчика, очень удобно Ctrl+s сохранить, F5 - запустить в терминале)

Не работает: (но особо и не старался)
- docker
- звук
- DB browser for SQLite - так то работает, но вводит с клавиатуры крякозябры

Можно запустить:
- Rubymine - IDE для Ruby on Rails
- LibreOffice - офисный пакет
- Thunderbird - почтовый клиент
- Dia - всяческие схемы рисовать
- KeePass2 - хранилка ключей
- Shutter - скриншоты делать

4. Linux Deploy
4.1 Ссылки и благодарности

Основная ссылка на 4pda: https://4pda.ru/forum/index.php?showtopic=378043

Разработчик: Anton Skshidlevsky (meefik)
Домашняя страница: meefik.ru
Магазин приложений Google Play: https://play.google.com/store/apps/details?id=ru.meefik.linuxdeploy
Исходные коды GitHub: https://github.com/meefik/linuxdeploy
Инструкции Wiki: https://github.com/meefik/linuxdeploy/wiki
Пожертвования (Donate): meefik.ru/donate

Спасибо Антону!

4.2 Установка Linux Deploy

Прежде всего - пишу личный опыт установки на свой телефон, на других устройствах возможны проблемы.
Основной ресурс для решения проблем - сайт 4pda. Мне помогает ;) причем тупо поиском аналогичных проблем

- получить на своем устройстве root права
- установить BusyBox (я не устанавливал, все и так работает)
- установить последний релиз LinuxDeploy или с Google Play или с форума 4pda (я скачал .apk с 4pda версия 2.2.2-244)

более подробно установка описана в шапке форума на 4pda

4.3 Настройки Linux Deploy

Не отключать экран = true
Не отключать Wi-Fi = true
Блокировка сна = true
Язык интерфейса = Русский
Размер шрифта = 11
Глубина прокрутки = 100
Тема интерфейса = Темная
Отметка времени = true
Показывать иконку = true
Скрытый режим = false
Автозапуск = false
Обрабатывать изменения сети = true
Директория окружения = /data/user/0/ru.meefik.linuxdeploy/files
Переменная PATH = ""
Включить CLI = true
TELNET = true
Порт = 5023
Локальный доступ = false
Веб-интерфейс = false
Режим отладки = false
Режим трассировки = false
Журналирование = false

4.4 Создание контейнера и установка дистрибутива
4.4.1 Настройка профиля
Метод контейнеризации = chroot
Дистрибутив = Ubuntu
Архитектура = arm64
Версия дистрибутива = bionic
Источник установки = http://ports.ubuntu.com/
Тип установки = Файл
Путь установки = ${EXTERNAL_STORAGE}/image_name.img
Размер образа (МБ) = Вычисляется автоматически
Файловая система = ext4
Имя пользователя = your_name
Пароль пользователя = your_password
Привилегированные пользователи = root
DNS-сервер = Автоматическое обнаружение
Лоализация = ru_RU.UTF-8
Запуск -> Включить = false
Монтирование -> Включить = false
SSH -> Включить = true
SSH -> Параметры SSH = default
PulseAudio -> Включить = false
Графика -> Включить = true
Графика -> Графическая подсистема = VNC

Графика -> Параметры GUI -> VNC -> Номер дисплея = 0
Графика -> Параметры GUI -> VNC -> Глубина цвета (бит) = 16
Графика -> Параметры GUI -> VNC -> DPI = 75
Графика -> Параметры GUI -> VNC -> Ширина экрана = 1850
Графика -> Параметры GUI -> VNC -> Высота экрана = 960
Графика -> Параметры GUI -> VNC -> Опции VNC-сервер = ""

Графика -> Окружение рабочего стола = Xfce

4.4.2 Установка системы

меню( три вертикальный точки) -> Установить

дождатья deploy

4.4.3 нажать СТОП (жму пару раз)

4.4.4 нажать СТАРТ 

много строчек с окончанием на  ... done

4.5 Дополнительные настройки

5. Установка учебного окружения
5.1 Пакеты

sudo apt-get install mc git gnupg2 curl nodejs npm

5.2 Ruby
5.2.1 RVM

gpg2 --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB
\curl -sSL https://get.rvm.io | bash -s stable

5.2.2 Ruby

rvm install 2.6

5.2.3 Rails другие джемы

gem install rails --version 5.2.2

5.3 Firefox

sudo apt-get install firefox-locale-ru firefox

5.4 ungit

npm config set prefix ~/npm
sudo ln -s /usr/bin/nodejs /usr/bin/mode
sudo -H npm install -g ungit

5.5 Geany

sudo apt-get install  geany

5.6 Rubymine

Загрузить с официального сайта, распаковать в любую директорию, запустить ./bin/rubymine.sh

6.Импорт готового контейнера

Ссылка на Google Диск: https://drive.google.com/open?id=1VeB53MSlqvW5yR0J6tDXZOcfqAjtEFC7

скопировать .img на sdcard
установить настройки как в пунктах 4.3
в основных настройках выбрать "Обновить окружение"
становить настройки как в пунктах 4.4.1
меню( три вертикальный точки) -> Конфигурировать

7. Доступ к окружению
я использую только доступ по SSH и VNC, 
есть другие способы, описанные на сайте 4pda

7.1 Доступ с android
7.1.1 SSH - Установил JuiceSSH

IP-адрес: localhost
Идентификатор: Логи: your_name, Пароль: your_password (данные беруться из настроек контейнера ПП 4.4.1)

7.1.2 VNC - Установил VNC Viewer
Address: localhost
Password: your_password (данные беруться из настроек контейнера ПП 4.4.1)

7.2 Доступ со стационарного компа (далее ББ)
7.2.1 по Wi-Fi
TODO

7.2.2 по USB через ADB (работаю так только из под винды, из под Linux не пробовал)
проброс портов: создать батник

c:\adb\adb.exe forward tcp:5900 tcp:5900
c:\adb\adb.exe forward tcp:5023 tcp:5023
c:\adb\adb.exe forward tcp:3000 tcp:3000

порт 5023 для SSH
порт 5900 для VNC
порт 3000 для Rails (т.е. запускаете в контейненре сайт на RoR и проверяете его в веб-браузере ББ)

7.2.2.1 SSH Установил patty
TODO


7.2.2.2 VNC Установил TightVNC
Remote host: localhost:5900
Password:  your_password (данные беруться из настроек контейнера ПП 4.4.1)

